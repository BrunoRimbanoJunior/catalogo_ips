Metadata-Version: 2.4
Name: backend
Version: 0.1.0
Summary: Add your description here
Requires-Python: >=3.12
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.122.0
Requires-Dist: pydantic>=2.12.4
Requires-Dist: supabase>=2.24.0
Requires-Dist: uvicorn>=0.38.0
Requires-Dist: python-dotenv==1.0.1
Requires-Dist: email-validator==2.2.0

# Backend (FastAPI) para Auth/Cadastro

1. Configure as variáveis no `.env` (copiar `.env.example`):
   - `SUPABASE_URL=https://<projeto>.supabase.co`
   - `SUPABASE_SERVICE_ROLE_KEY=<service-role>` (não expor ao front)
2. Instale dependências:
   ```bash
   pip install -r requirements.txt
   ```
3. Rode o servidor local:
   ```bash
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

### Endpoints
- `GET /health` – teste.
- `POST /auth/register` – cria/atualiza usuário no Supabase Auth (via service role) e faz upsert na tabela `profiles` com status `pending`.

### Tabelas/policies esperadas
- Tabela `profiles` com colunas: `id (uuid PK)`, `status text`, `person_type`, `country`, `state`, `city`, `cpf_cnpj`, `full_name`, `phone_area`, `phone_number`, `email`, `device_fingerprint`, `created_at timestamp`.
- Habilitar RLS:
  - Usuário pode ler/escrever apenas sua linha (`id = auth.uid()`).
  - Admin (role) pode ler todas.

Use o `SERVICE_ROLE_KEY` somente no backend. O front usa apenas `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY`.
